---
import type { Event } from '../lib/eventSchema';

interface Props {
  event: Event;
  currentIndex: number;
  markerLabel?: string | null;
  markerClass?: string | null;
}

const { event, currentIndex, markerLabel, markerClass } = Astro.props;

// Helper function to extract episode/season from tags
function getTagValue(tags: string[], key: string): string {
  const tag = tags.find((t) => t.startsWith(`${key}:`));
  return tag ? tag.split(':')[1] || '1' : '1';
}
---

<article
  class:list={[
    'bg-white rounded-lg shadow-lg overflow-hidden',
    markerLabel ? 'border-2 border-purple-300' : 'border border-gray-200',
    markerClass,
  ]}
  transition:name={`event-card-${currentIndex}`}
>
  <!-- Marker Badge -->
  {
    markerLabel && (
      <div class="bg-purple-100 border-b-2 border-purple-300 px-6 py-3">
        <div class="flex items-center gap-2">
          <span class="text-2xl">ðŸŽ¯</span>
          <span class="text-purple-900 font-bold text-lg">{markerLabel}</span>
        </div>
      </div>
    )
  }

  <!-- Event Header -->
  <div class="px-6 py-6 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white">
    <div class="flex justify-between items-start mb-2">
      <h1 class="text-3xl font-bold text-gray-900">
        {event.delta ? event.delta : <span class="text-gray-400 italic">Unknown time</span>}
      </h1>
      <span class="text-sm text-gray-500 font-mono bg-gray-100 px-3 py-1 rounded-full">
        #{currentIndex + 1}
      </span>
    </div>
    <div class="flex items-center gap-2 text-sm text-gray-600">
      <span>Season {getTagValue(event.tags, 'season')}</span>
      <span>â€¢</span>
      <span>Episode {getTagValue(event.tags, 'episode')}</span>
    </div>
  </div>

  <!-- Images -->
  {
    event.images && event.images.length > 0 && (
      <div class="px-6 py-6 bg-gray-50">
        <div
          class:list={[
            'grid gap-4',
            event.images.length === 1
              ? 'grid-cols-1'
              : event.images.length === 2
                ? 'grid-cols-2'
                : 'grid-cols-2 md:grid-cols-3',
          ]}
        >
          {event.images.map((image) => (
            <img
              src={image}
              alt="Event image"
              class="w-full rounded-lg object-cover shadow-md"
              style="max-height: 400px;"
              loading="lazy"
            />
          ))}
        </div>
      </div>
    )
  }

  <!-- Event Description -->
  <div class="px-6 py-6">
    <h2 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">Description</h2>
    <p class="text-lg text-gray-700 leading-relaxed">{event.description}</p>
  </div>

  <!-- Tags -->
  <div class="px-6 py-6 border-t border-gray-200 bg-gray-50">
    <h2 class="text-sm font-semibold text-gray-700 mb-3">Tags</h2>
    <div class="flex flex-wrap gap-2">
      {
        event.tags.map((tag) => (
          <span class="bg-white text-gray-700 px-4 py-2 rounded-full text-sm font-medium border border-gray-200 shadow-sm">
            {tag}
          </span>
        ))
      }
    </div>
  </div>
</article>
